package com.lj.iot.common.sso.config;import com.lj.iot.common.redis.properties.RedisCacheProperties;import com.lj.iot.common.sso.properties.SSOProperties;import com.lj.iot.common.sso.interceptor.LoginInterceptor;import com.lj.iot.common.sso.interceptor.MultipointLoginInterceptor;import com.lj.iot.common.sso.interceptor.UserDtoInterceptor;import lombok.extern.slf4j.Slf4j;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;import javax.annotation.Resource;/** * 拦截器配置 */@EnableConfigurationProperties(SSOProperties.class)@Configuration@Slf4jpublic class SSOConfig implements WebMvcConfigurer {    @Resource    private SSOProperties ssoProperties;    public SSOConfig() {    }    @Bean    public UserDtoInterceptor userDtoInterceptor() {        log.info("==============================获取用户信息拦截器===============================");        return new UserDtoInterceptor(ssoProperties);    }    @Bean    public MultipointLoginInterceptor multipointLoginInterceptor() {        log.info("==============================多点登录拦截器===============================");        return new MultipointLoginInterceptor(ssoProperties);    }    @Bean    public LoginInterceptor loginInterceptor() {        log.info("==============================登录拦截器===============================");        return new LoginInterceptor(ssoProperties);    }    public void addInterceptors(InterceptorRegistry registry) {        // 多点校验必须放在Login验证前，不然逻辑会有问题        registry.addInterceptor(this.multipointLoginInterceptor())                .order(0)                .addPathPatterns("/**")                .excludePathPatterns("/css/**", "/images/**", "/js/**", "/layui/**", "/layuiadmin/**", "/pdf/**", "/treegrid/**", "/swagger-resources/**", "/webjars/**", "/v2/**", "/swagger**/**", "/swagger-ui.html", "/e/swagger-ui.html", "/inner/**", "/api/open/**")                .excludePathPatterns(ssoProperties.getExcludeMultipointLoginPathPatterns() == null ? new String[]{""} : ssoProperties.getExcludeMultipointLoginPathPatterns());        // 获取登录信息拦截器        registry.addInterceptor(this.userDtoInterceptor())                .order(1)                .addPathPatterns("/**");        registry.addInterceptor(this.loginInterceptor())                .order(2)                .addPathPatterns("/**")                .excludePathPatterns("/css/**", "/images/**", "/js/**", "/layui/**", "/layuiadmin/**", "/pdf/**", "/treegrid/**", "/swagger-resources/**", "/webjars/**", "/v2/**", "/swagger**/**", "/swagger-ui.html", "/exchange/swagger-ui.html", "/inner/**", "/api/open/**")                .excludePathPatterns(ssoProperties.getExcludeLoginPathPatterns() == null ? new String[]{""} : ssoProperties.getExcludeLoginPathPatterns());    }    @Override    public void addResourceHandlers(ResourceHandlerRegistry registry) {        registry.addResourceHandler("swagger-ui.html")                .addResourceLocations("classpath:/META-INF/resources/");        registry.addResourceHandler("/webjars/**")                .addResourceLocations("classpath:/META-INF/resources/webjars/");    }}