<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lj.iot.biz.db.smart.mapper.HotelFloorHomeMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.lj.iot.biz.db.smart.entity.HotelFloorHome">
        <id column="id" property="id"/>
        <result column="hotel_user_id" property="hotelUserId"/>
        <result column="hotel_id" property="hotelId"/>
        <result column="floor_id" property="floorId"/>
        <result column="home_id" property="homeId"/>
        <result column="remarks" property="remarks"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id
        , hotel_user_id, hotel_id, floor_id, home_id, remarks, create_time, update_time
    </sql>

    <select id="listFloorHomeVo" resultType="com.lj.iot.biz.base.vo.FloorHomeVo">
        select hfh.floor_id floorId,
               hfh.home_id,
               hfh.hotel_id,
               h.home_name,
               (select count(1) from user_device  where home_id=hfh.home_id and `status`=false and is_show=true) as outLine
        from hotel_floor_home hfh
                 inner join home h on hfh.home_id = h.id
        where hfh.hotel_id = #{hotelId}
          and hfh.hotel_user_id = #{userId}
        order by floor_id ,h.home_name
    </select>



    <select id="listFloorHomeByFloorId" resultType="com.lj.iot.biz.base.vo.FloorHomeVo">
        select
               hfh.home_id,
               hfh.hotel_id,
               h.home_name,
               (select count(1) from user_device  where home_id=hfh.home_id and `status`=false and is_show=true) as outLine
        from hotel_floor_home hfh
                 inner join home h on hfh.home_id = h.id
        where hfh.floor_id = #{floorId}
          and hfh.hotel_user_id = #{userId}
        order by floor_id ,h.home_name
    </select>

    <select id="getHotelFloorRoomList" parameterType="com.lj.iot.biz.base.vo.HotelFloorRoomVo" resultType="com.lj.iot.biz.base.vo.HotelFloorRoomVo">
        SELECT k.hotel_name hotelName,k.id hotelId,f.floor_name floorName,f.id floorId,r.id roomId,r.room_name roomName
        from home h, hotel_floor f, hotel_floor_home hh, hotel k,home_room r
            where
            k.id=#{params.hotelId}
            <if test="params.floorId!=null" >
                AND f.id=#{params.floorId}
            </if>
            and k.id=f.hotel_id
            and f.id = hh.floor_id
            and hh.home_id=h.id
            and hh.hotel_id=k.id
            and r.home_id=h.id
    </select>

    <select id="getHotelFloorRoom" parameterType="long" resultType="com.lj.iot.biz.base.vo.HotelFloorRoomVo">
        SELECT k.hotel_name hotelName,k.id hotelId,f.floor_name floorName,f.id floorId,r.id roomId,r.room_name roomName
        from home h, hotel_floor f, hotel_floor_home hh, hotel k,home_room r
        where r.id= #{roomId}
            and k.id=#{hotelId}
            and k.id=f.hotel_id
            and f.id = hh.floor_id
            and hh.home_id=h.id
            and hh.hotel_id=k.id
            and r.home_id=h.id
    </select>
</mapper>
