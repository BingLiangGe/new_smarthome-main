<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lj.iot.biz.db.smart.mapper.HomeMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.lj.iot.biz.db.smart.entity.Home">
        <id column="id" property="id" />
        <result column="address" property="address" />
        <result column="city" property="city" />
        <result column="country" property="country" />
        <result column="is_default_home" property="isDefaultHome" />
        <result column="district" property="district" />
        <result column="home_name" property="homeName" />
        <result column="home_type" property="homeType" />
        <result column="lat" property="lat" />
        <result column="lng" property="lng" />
        <result column="province" property="province" />
        <result column="remarks" property="remarks" />
        <result column="user_id" property="userId" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>

    <select id="customPage" resultType="com.lj.iot.biz.base.vo.HomePageVo">
        SELECT * FROM home h INNER JOIN user_account u ON h.`user_id`=u.`id`
        <where>
            <if test="params.userId!=null and params.userId!=''">
                AND h.user_id=#{params.userId}
            </if>
            <if test="params.search!=null and params.search!=''">
                AND (
                h.home_name LIKE CONCAT(#{params.search},"%")
                OR u.mobile LIKE CONCAT(#{params.search},"%")
                OR u.email LIKE CONCAT(#{params.search},"%")
                OR u.nickname LIKE CONCAT(#{params.search},"%")
                )
            </if>
        </where>
        ORDER BY h.id DESC
    </select>
</mapper>
