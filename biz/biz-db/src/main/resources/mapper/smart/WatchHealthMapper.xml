<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lj.iot.biz.db.smart.mapper.WatchHealthMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.lj.iot.biz.db.smart.entity.WatchHealth">
        <id column="health_id" property="healthId" />
        <result column="device_id" property="deviceId" />
        <result column="health_value" property="healthValue" />
        <result column="health_type" property="healthType" />
        <result column="create_time" property="createTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        health_id, device_id, health_value, health_type, create_time
    </sql>


    <select id="selectChartData" resultType="com.lj.iot.biz.base.vo.WatchChartsVo">
        <if test="type == 1">
            SELECT
            HOUR (create_time) AS health_date,
            FORMAT(AVG(health_value), 2) health_value
            FROM
            watch_health
            WHERE
            DATE_FORMAT(create_time, '%Y-%m-%d') = #{date} AND device_id=#{deviceId} AND health_type=#{dataType}
            GROUP BY
            health_date
            ORDER BY health_date
        </if>

        <if test="type == 2">
            SELECT
            DAY (create_time) AS health_date,
            FORMAT(AVG(health_value), 2) health_value
            FROM
            watch_health
            WHERE
            DATE_FORMAT(create_time, '%Y-%m') = #{date} AND device_id=#{deviceId} AND health_type=#{dataType}
            GROUP BY
            health_date
            ORDER BY health_date
        </if>

        <if test="type == 3">
            SELECT
            MONTH (create_time) AS health_date,
            FORMAT(AVG(health_value), 2) health_value
            FROM
            watch_health
            WHERE
            DATE_FORMAT(create_time, '%Y') =  #{date} AND device_id=#{deviceId} AND health_type=#{dataType}
            GROUP BY
            health_date
            ORDER BY health_date
        </if>
    </select>

</mapper>
